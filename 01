<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>刑事訴訟法 (1) 穴埋め学習ツール</title>
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans JP", sans-serif; margin: 24px; line-height: 1.65; }
    .wrap { max-width: 1080px; }
    h1 { margin: 0 0 10px; }
    .small { font-size: 13px; color: #666; margin: 0 0 16px; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
    .passage { background: #fafafa; border: 1px solid #eee; border-radius: 10px; padding: 14px; white-space: pre-wrap; }
    .grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 14px; }
    .item { border: 1px solid #eee; border-radius: 10px; padding: 12px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
    .tag { font-weight: 700; width: 56px; }
    input[type="text"] { padding: 10px 12px; font-size: 16px; width: 260px; max-width: 100%; }
    .feedback { font-weight: 700; }
    .ok { color: #0a7a2f; }
    .ng { color: #b00020; }
    .controls { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }
    button { padding: 10px 14px; font-size: 16px; cursor: pointer; }
    code { background: #f3f3f3; padding: 2px 6px; border-radius: 6px; }
    .score { margin-top: 10px; font-weight: 800; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>刑事訴訟法（1）穴埋め</h1>
    <p class="small">
      入力して「回答」を押すと採点します（前後の空白は無視、全角/半角はある程度正規化）。
      複数正答があり得る箇所は候補を複数登録しています。
    </p>

    <div class="card">
      <div id="passage" class="passage"></div>

      <div class="controls">
        <button id="checkBtn">回答（採点）</button>
        <button id="revealBtn" type="button">答えを見る（全表示）</button>
        <button id="clearBtn" type="button">入力をクリア</button>
      </div>

      <div id="score" class="score"></div>

      <div id="items" class="grid"></div>
    </div>
  </div>

  <script>
    // ==============
    // (1) 本文（空欄つき）
    // ==============
    const passageText = `刑法を具体的に実現するために必ず守らなければならない（①続）・規則を定める法律を刑事訴訟法と言う。
刑事訴訟の構造に関しては、刑事訴訟法が、「（②）制度」や「（③）主義」を採用していることなどから、わが国では（④）主義を採っていると考えられている。
捜査とは、被疑者の身柄および証拠を保全する捜査機関の活動のことをいう。捜査は、できる限り（⑤）捜査の方法によらなければならない原則を「（⑤）捜査の原則」という。一方、（⑥）処分に関しては、法律に定めがない限りできないとする原則を「（⑥）処分法定主義」という。（⑤）捜査と（⑥）捜査の区別基準に関して重要な判例は、最高裁判所の昭和（⑦）年3月16日決定（刑集30巻2号187頁）である。
最高裁は、「捜査において（⑥）手段を用いることは、法律の（⑧）がある場合に限り許容されるものである。」とし、その（⑥）手段については、有形力の行使を伴う手段を意味するものではなく、「個人の（⑨）を制圧し、身体、住居、財産等に制約を加えて強制的に捜査目的を実現する行為など、特別の（⑧）がなければ許容することが相当でない手段を意味するもの」であるとしている。
また、憲法（⑩）条や35条に規定される（⑪）も捜査に関する重要な原則である。`;

    // ==============
    // 正答データ（複数候補OK）
    // ==============
    const answers = [
      { id: "①", label: "①", correct: ["手続", "訴訟手続"] },
      { id: "②", label: "②", correct: ["弾劾"] , note: "※『弾劾制度』の『弾劾』" },
      { id: "③", label: "③", correct: ["当事者"] , note: "※『当事者主義』の『当事者』" },
      { id: "④", label: "④", correct: ["当事者主義"] },
      { id: "⑤", label: "⑤", correct: ["任意"] },
      { id: "⑥", label: "⑥", correct: ["強制"] },
      { id: "⑦", label: "⑦", correct: ["51", "五一"] }, // 表記ゆれ対応（必要なら削除OK）
      { id: "⑧", label: "⑧", correct: ["根拠", "規定"] },
      { id: "⑨", label: "⑨", correct: ["意思", "自由意思"] },
      { id: "⑩", label: "⑩", correct: ["31"] },
      { id: "⑪", label: "⑪", correct: ["令状主義"] },
    ];

    // 画面描画
    const $passage = document.getElementById("passage");
    const $items = document.getElementById("items");
    const $score = document.getElementById("score");
    const $checkBtn = document.getElementById("checkBtn");
    const $revealBtn = document.getElementById("revealBtn");
    const $clearBtn = document.getElementById("clearBtn");

    $passage.textContent = passageText;

    function normalize(s) {
      // 前後空白除去 + NFKCで全角/半角のゆれを軽く吸収
      return (s ?? "")
        .trim()
        .replace(/\u3000/g, " ")
        .normalize("NFKC");
    }

    function render() {
      $items.innerHTML = "";
      answers.forEach((q, idx) => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <div class="tag">${q.label}</div>
          <input type="text" id="in_${idx}" placeholder="${q.label} の答え" />
          <div id="fb_${idx}" class="feedback"></div>
        `;
        $items.appendChild(div);
      });
    }

    function checkAll() {
      let okCount = 0;

      answers.forEach((q, idx) => {
        const user = normalize(document.getElementById(`in_${idx}`).value);
        const fb = document.getElementById(`fb_${idx}`);

        const correctList = q.correct.map(normalize);
        const isOk = user.length > 0 && correctList.includes(user);

        if (isOk) {
          okCount += 1;
          fb.className = "feedback ok";
          fb.textContent = "正解";
        } else {
          fb.className = "feedback ng";
          fb.textContent = user ? "不正解" : "未入力";
        }
      });

      $score.textContent = `スコア：${okCount} / ${answers.length}`;
    }

    function revealAll() {
      answers.forEach((q, idx) => {
        const fb = document.getElementById(`fb_${idx}`);
        const show = q.correct.join(" / ");
        fb.className = "feedback";
        fb.innerHTML = `正答：<code>${show}</code>`;
      });
      $score.textContent = "";
    }

    function clearAll() {
      answers.forEach((q, idx) => {
        document.getElementById(`in_${idx}`).value = "";
        const fb = document.getElementById(`fb_${idx}`);
        fb.className = "feedback";
        fb.textContent = "";
      });
      $score.textContent = "";
    }

    // 初期描画
    render();

    // ボタン
    $checkBtn.addEventListener("click", checkAll);
    $revealBtn.addEventListener("click", revealAll);
    $clearBtn.addEventListener("click", clearAll);
  </script>
</body>
</html>
